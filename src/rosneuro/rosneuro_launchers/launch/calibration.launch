<?xml version="1.0"?>
<launch>

	<!-- protocol arguments -->
		<arg name="subject"      default="f1"/>
		<arg name="task"         default="mi_bhbf"/>
		<arg name="modality" 	 default='calibration'/>
		<arg name="classes"      default='[773, 771]'/>
		<arg name="trials"       default='[10, 10]'/>
		<arg name="thresholds"   default='[0.9, 0.9]'/>
		<arg name="extra"     	 default=""/>
		<arg name="show_on_rest" default="True"/>
			
	<!-- acquisition arguments -->
		<arg name="plugin" default='rosneuro::EGDDevice'/>
		<arg name="devarg" default='/var/home/piero/data.gdf'/> <!-- put gtec here -->
		<arg name="framerate"  default='16'/>
		<arg name="samplerate" default='512'/>
			<rosparam command="load" file="$(find rosneuro_launchers)/config/ChainCfg.yaml" />

	<!-- recorder -->
		<arg name="autostart" default='true'/>
		<arg name="filepath"  default='$(env HOME)/Projects/gdf_recordings/$(arg task)/$(arg modality)/$(arg subject)/' />

	<!-- create the folder if not exists -->
		<param name="dummy" command="mkdir -p $(arg filepath)" />
		<param name="dummy1" command="mkdir -p $(arg filepath)/raw/" />
			

	<!-- load protocol parameters -->
		<rosparam param="/protocol/subject"	 subst_value="True">$(arg subject)</rosparam>
		<rosparam param="/protocol/modality" subst_value="True">$(arg modality)</rosparam>
		<rosparam param="/protocol/task"	 subst_value="True">$(arg task)</rosparam>
		<rosparam param="/protocol/extra"	 subst_value="True">$(arg extra)</rosparam>

	<!-- aquisition node -->
	<node name="acquisition" pkg="rosneuro_acquisition" type="acquisition" output="screen" >
		<param name="~plugin" 	  value="$(arg plugin)"/>
		<param name="~devarg" 	  value="$(arg devarg)"/>
		<param name="~samplerate" value="$(arg samplerate)"/>
		<param name="~framerate"  value="$(arg framerate)"/>
    <remap from="/neurodata" to="/raw/neurodata"/>
	</node>

  <node name="filterchain_node" pkg="rosneuro_filters" type="filterchain_node" output="screen" >
    <remap from="/neurodata" to="/raw/neurodata"/>
    <remap from="/neurodata_filtered" to="/neurodata"/>
		<param name="configname" value="ChainCfg" />
	</node>	

	<!-- recorder node -->
	<node name="recorder" pkg="rosneuro_recorder" type="recorder" >
		<param name="~autostart" value="$(arg autostart)"/>
		<param name="~filepath" value="$(arg filepath)"/>
	</node>
	
		<!-- recorder node -->
	<node name="recorder_raw" pkg="rosneuro_recorder" type="recorder" >
    <remap from="/neurodata" to="/raw/neurodata"/>
		<param name="~autostart" value="$(arg autostart)"/>
		<param name="~filepath" value="$(arg filepath)/raw/"/>
	</node>

  	<!-- neurowheel node -->
	<node name="trainingwheel" pkg="rosneuro_feedback_wheel" type="trainingwheel"  output="screen">
		<rosparam param="modality" subst_value="True">$(arg modality)</rosparam>
		<rosparam param="thresholds" subst_value="True">$(arg thresholds)</rosparam>
		<rosparam param="classes" subst_value="True">$(arg classes)</rosparam>
		<rosparam param="trials" subst_value="True">$(arg trials)</rosparam>
		<rosparam param="show_on_rest" subst_value="True">$(arg show_on_rest)</rosparam>
	</node>

</launch>
